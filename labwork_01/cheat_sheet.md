# Лабораторна робота 1

Всі завдання виконуються в Supabase (PostgreSQL)

## Завдання 1.1. Створення бази даних у вигляді mdf-файла у середовищі Visual Studio

```sql
-- Створюємо схему, яка буде виступати ізольованим контейнером 
-- замість окремої БД "ХлібПрізвище"
CREATE SCHEMA bread_venhrina;

-- Коментар, щоб не забути, що це
COMMENT ON SCHEMA bread_venhrina IS 'Лабораторна робота 1: База даних Хліб';
```

## Завдання 1.4. Створення бази даних засобами мови DDL

```sql
CREATE SCHEMA IF NOT EXISTS trade_venhrina;

COMMENT ON SCHEMA trade_venhrina IS 'Лабораторна: Торгівля (Trade)';
```

## Завдання 1.5. Створення таблиць засобами мови DDL

```sql
-- Створюємо таблицю Замовники (customers) (аналог Завдання 1.5.1)
CREATE TABLE trade_venhrina.customers (
    customer_id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY, -- аналог IDENTITY(1,1)
    surname TEXT NOT NULL,                                           -- прізвище замовника
    city TEXT,                                                       -- місто
    rating INT                                                       -- рейтинг
);

```
```sql
-- Створюємо таблицю Продавці (sellers) (аналог Завдання 1.5.2)
CREATE TABLE trade_venhrina.sellers (
    seller_id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    surname TEXT NOT NULL,       -- прізвище продавця
    city TEXT,                   -- місто
    commission NUMERIC(5, 2)     -- комісійні (напр. 12.50)
);
```

```sql
-- Створюємо таблицю Замовлення (orders) зі зв'язками (аналог Завдання 1.5.3)
CREATE TABLE trade_venhrina.orders (
    order_id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    order_date DATE DEFAULT CURRENT_DATE, -- дата замовлення
    amount NUMERIC(10, 2),                -- сума (гроші)
    
    -- Зовнішні ключі (Foreign Keys)
    seller_id BIGINT REFERENCES trade_venhrina.sellers(seller_id) ON DELETE SET NULL,
    customer_id BIGINT REFERENCES trade_venhrina.customers(customer_id) ON DELETE CASCADE
);
```

## Завдання 1.6. Заповнення таблиць даними засобами мови SQL 

```sql
-- Заповнюємо таблицю Замовники (customers)
-- Дані взяті з методички (стор. 33), але дещо адаптовані під нову схему
INSERT INTO trade_venhrina.customers (surname, city, rating)
VALUES 
  ('Іваненко', 'Київ', 95),
  ('Петренко', 'Київ', 80),
  ('Сидоренко', 'Київ', 25),
  ('Іванченко', 'Харків', 90),
  ('Петриченко', 'Харків', 87),
  ('Сидорченко', 'Харків', 95),
  ('Іваненчук', 'Львів', 90),
  ('Петренчук', 'Львів', 80),
  ('Сидоренчук', 'Львів', 75),
  ('Іванов', 'Одеса', 90);
```

```sql
-- Заповнюємо таблицю Продавці (sellers)
-- Відповідно до завдання слід придумати 10 продавців
INSERT INTO trade_venhrina.sellers (surname, city, commission)
VALUES 
  ('Коваленко', 'Київ', 12.00),
  ('Бондаренко', 'Харків', 10.50),
  ('Ткаченко', 'Одеса', 11.00),
  ('Шевченко', 'Львів', 13.00),
  ('Бойко', 'Дніпро', 10.00),
  ('Кравченко', 'Київ', 12.50),
  ('Козак', 'Запоріжжя', 11.50),
  ('Мельник', 'Харків', 10.00),
  ('Олійник', 'Вінниця', 14.00),
  ('Лисенко', 'Полтава', 12.00);
```

```sql
-- Заповнюємо таблицю Замовлення (orders) за допомогою автоматизації
-- Замість того, щоб писати 30 рядків INSERT руками, вони згенеруються автоматично.
-- Це виконає вимогу "не менше 30 записів" 
INSERT INTO trade_venhrina.orders (order_date, amount, seller_id, customer_id)
SELECT 
  -- Генеруємо випадкову дату за останні 30 днів
  CURRENT_DATE - (random() * 30)::int,
  -- Генеруємо випадкову суму від 100 до 5000
  (random() * 4900 + 100)::numeric(10,2),
  -- Випадковий ID продавця (від 1 до 10)
  floor(random() * 10 + 1)::int,
  -- Випадковий ID замовника (від 1 до 10)
  floor(random() * 10 + 1)::int
FROM generate_series(1, 35); -- Генеруємо 35 замовлень (із запасом)
```
